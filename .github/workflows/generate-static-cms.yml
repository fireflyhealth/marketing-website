name: Generate Static CMS
on:
  workflow_dispatch:
  repository_dispatch:
    types: [cms-generate-webhook]

jobs:
  Generate-Static-CMS:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/workflows/yarn-setup
      - name: get latest cms data
        run: yarn update-site-data
      - name: build
        run: cd www && yarn build
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "`r format(Sys.time(), '%d %B, %Y')`: generate latest cms locally"
          title: "[Workflow] Generate latest CMS"
          body: "This PR was generated by the workflow, indicating that the editor wishes to publish the latest content."
          branch: cms-updates
          base: production