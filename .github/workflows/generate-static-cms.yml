name: Generate Static CMS
on:
  workflow_dispatch:
  repository_dispatch:
    types: [cms-generate-webhook]

jobs:
  Generate-Static-CMS:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/workflows/yarn-setup
      - name: get latest cms data
        run: yarn update-site-data
        env:
          NEXT_PUBLIC_FORCE_DATASET: production
          NEXT_PUBLIC_SANITY_DATASET: production
      - name: build
        run: cd www && yarn build
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "chore: generate latest cms locally"
          title: "[Sanity CMS Updates] Generate latest CMS locally"
          body: "This PR was generated by the workflow, indicating that the editor wishes to publish the latest content."
          branch: cms-updates
          base: main